(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[283],{21403:function(e,t,n){Promise.resolve().then(n.bind(n,71062))},71062:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return i}});var r=n(27573),a=n(11925),o=n(67746);function i(e){let{children:t}=e;return(0,r.jsx)(a.hH,{children:(0,r.jsx)(o.default,{children:t})})}},96755:function(e,t,n){"use strict";n.d(t,{Ck:function(){return g},IR:function(){return f},Pd:function(){return h},Rc:function(){return b},_y:function(){return m},gq:function(){return _},k7:function(){return v},ml:function(){return d},uV:function(){return u},wO:function(){return l},yU:function(){return c},yq:function(){return p}});var r=n(83041),a=n(11492),o=n(35146),i=n(84983),s=n(54603);let u=()=>(0,r.WE)("/api/legal",{staleTime:1/0,meta:{noToast:!0}}),l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,a.useIsClaudeDot)();return(0,r.uC)("/api/auth/send_magic_link","POST",{...e,transformVariables:e=>({...e,source:t?"claude":"console"})})},c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,a.useIsClaudeDot)();return(0,r.uC)("/api/auth/exchange_nonce_for_code","POST",{...e,transformVariables:e=>({...e,source:t?"claude":"console"})})},d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,a.useIsClaudeDot)();return(0,r.uC)("/api/auth/verify_magic_link","POST",{...e,transformVariables:e=>({...e,source:t?"claude":"console"})})},f=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,a.useIsClaudeDot)(),n=(0,s.useRouter)();return(0,r.uC)("/api/auth/verify_google","POST",{...e,onSuccess:(t,r,a)=>{!t.success&&t.sso_url?n.push(t.sso_url):e.onSuccess&&e.onSuccess(t,r,a)},transformVariables:e=>({...e,source:t?"claude":"console"})})},h=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,a.useIsClaudeDot)();return(0,r.uC)("/api/auth/accept_invite","POST",{...e,transformVariables:e=>({...e,source:t?"claude":"console"})})},m=()=>(0,r.uC)("/api/auth/logout","POST"),p=()=>{let e=(0,i.useQueryClient)();return(0,r.uC)("/api/account","PUT",{async onSuccess(){await e.invalidateQueries([o.aY])}})},g=()=>(0,r.Ne)("/api/account","PUT",(e,t)=>(null==t?void 0:t.account)?{...t,account:{...t.account,settings:e}}:t,{queryKey:[o.aY],transformVariables:e=>({settings:e})}),v=()=>{let e=(0,i.useQueryClient)();return(0,r.uC)("/api/account/accept_legal_docs","PUT",{async onSuccess(){await e.invalidateQueries([o.aY])}})};function _(e){return(0,r.WE)("/api/signups/".concat(e),{enabled:!!e,staleTime:0})}function b(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=(0,i.useQueryClient)(),u=(0,s.useRouter)();return(0,r.uC)("/api/enterprise_auth/sso_callback?code=".concat(e,"&state=").concat(t),"GET",{...n,onSuccess:async function(){for(var e,t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];await a.invalidateQueries([o.aY]),u.push("/"),null===(e=n.onSuccess)||void 0===e||e.call(n,...r)}})}},31271:function(e,t,n){"use strict";n.d(t,{K5:function(){return p},Ql:function(){return w},Z1:function(){return y},_A:function(){return v},nJ:function(){return _},rN:function(){return g},wy:function(){return b},z6:function(){return h}});var r=n(11492),a=n(23532),o=n(16096),i=n(59374),s=n(14983),u=n(87050);n(88337);var l=n(54603),c=n(7653),d=n(96755),f=n(31257);let h=()=>{let e=(0,l.useRouter)(),t=(0,a.useCookies)();return{refresh:()=>{e.refresh()},switchAndRefresh:(e,n)=>{t.set(s.cn.LAST_ACTIVE_ORG,e),n?location.pathname=n:location.reload()}}},m=e=>{let{account:t}=(0,o.useCurrentAccount)();return t&&((0,f.wJ)({account:t,isClaudeDot:e})||(0,f.c6)(t,e))?"/onboarding":t&&(0,f.kK)(t,e)?"/invites":t&&(0,f.D_)(t,e)?"/create":e?"/new":"/dashboard"};function p(e){let{value:t}=(0,u.F)("show_affirmative_consent"),{value:n}=(0,u.F)("show_affirmative_consent_for_privacy_policy");return(0,c.useMemo)(()=>[...t===e?["aup","consumer-terms"]:[],...n===e?["privacy"]:[]],[n,t,e])}let g=(e,t,n)=>{let{data:r}=(0,d.uV)(),{mutateAsync:a}=(0,d.k7)();return(0,c.useCallback)(async()=>{if(!e||!r||0===t.length)return;let o=t.map(e=>({document_id:r[e],accepted_via_checkbox:n}));await a({acceptances:o})},[e,r,t,a,n])},v=(e,t)=>{let{account:n,refetch:r,setActiveOrganizationUUID:a}=(0,o.useCurrentAccount)(),[s,u]=(0,c.useState)(!1),[l,f]=(0,c.useState)(!1),h=_(),{addSuccess:m}=(0,i.useToasts)(),{data:p}=(0,d.gq)(e);return(0,c.useEffect)(()=>{n&&s&&l&&(t?t(h):h())},[l,h,s,n,t]),(0,c.useCallback)(async()=>{u(!0),await r(),(null==p?void 0:p.organization_uuid)&&(a(p.organization_uuid),m("Successfully joined ".concat(p.organization_name))),f(!0)},[p,m,r,a])},_=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=(0,l.useSearchParams)().get("returnTo"),n=b(e);return(0,c.useCallback)(()=>{n(t)},[n,t])},b=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],{account:t}=(0,o.useCurrentAccount)(),[n,a]=(0,c.useState)(!1),i=(0,l.useRouter)(),[s,u]=(0,c.useState)(null),d=(0,l.usePathname)(),h=(0,l.useSearchParams)(),p=(0,r.useIsClaudeDot)(),g=m(p);return(0,c.useEffect)(()=>{(n||e)&&!t&&i.push((0,f.C2)(d,h.toString()))},[t,i,n,e,d,h]),(0,c.useEffect)(()=>{if(n&&t){let e=(0,f.eX)(t,s,g,p);i.push(e)}},[t,i,n,s,g,p]),(0,c.useCallback)(e=>{e&&u(e),a(!0)},[])};function y(){let[e,t]=(0,c.useState)(!1);return{getRecaptchaToken:(0,c.useCallback)(async(e,n)=>(t(!0),new Promise((r,a)=>{if("undefined"==typeof grecaptcha)return t(!1),a(Error("Recaptcha failed to load"));grecaptcha.enterprise.ready(()=>{grecaptcha.enterprise.execute(e,{action:n}).then(e=>{r(e),t(!1)},e=>{t(!1),a(e)})})})),[]),isLoading:e}}function w(e){let[t,n]=(0,c.useState)(!1);(0,c.useEffect)(()=>{if(!t){let t=setInterval(()=>{window.grecaptcha&&(n(!0),e())},10);return()=>clearInterval(t)}},[t,n,e])}},31257:function(e,t,n){"use strict";n.d(t,{$6:function(){return d},C2:function(){return l},D_:function(){return i},G9:function(){return c},c6:function(){return a},cG:function(){return s},eX:function(){return u},kK:function(){return o},kY:function(){return f},wJ:function(){return r}});let r=e=>{let{account:t,isClaudeDot:n}=e,r=!1===t.settings.has_finished_claudeai_onboarding;return!t.full_name||!t.display_name||!!n&&r},a=(e,t)=>t&&!e.completed_verification_at,o=(e,t)=>!!function(e,t){for(let n of e.invites)if(n.organization.capabilities&&n.organization.capabilities.includes(t))return n}(e,t?"raven":"api"),i=(e,t)=>!t&&0===e.invites.length&&0===e.memberships.filter(e=>e.organization.capabilities.includes("api")).length,s=(e,t)=>r({account:e,isClaudeDot:t})||a(e,t)||o(e,t)||i(e,t),u=(e,t,n,r)=>{if(!t||!t.startsWith("/"))return n;if(s(e,r)){let e=new URLSearchParams({returnTo:t});return"".concat(n,"?").concat(e.toString())}return c(t)},l=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/login",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a="".concat(e,"?").concat(t),o=new URLSearchParams(r);return o.append("returnTo",a),"".concat(n,"?").concat(o.toString())};function c(e){let t=new URL(e,"http://example.com");return t.pathname+t.search}function d(e){return e.reduce((e,t)=>{let n=localStorage.getItem(t);return null!==n&&e.push([t,n]),e},[])}function f(e){e.forEach(e=>{let[t,n]=e;localStorage.setItem(t,n)})}},79755:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var r=n(27573),a=n(11492),o=n(16096),i=n(77997);let s=()=>{let e=(0,a.useIsClaudeDot)(),{websiteBaseUrl:t}=(0,a.useConfiguration)();return e?(0,r.jsxs)(r.Fragment,{children:[" ","Or consider"," ",(0,r.jsx)("a",{href:"/settings/billing?action=subscribe",className:"font-bold underline",rel:"noreferrer",children:"upgrading to Claude Pro"}),"."]}):(0,r.jsxs)(r.Fragment,{children:[" ","Or"," ",(0,r.jsx)(i.default,{href:"".concat(t,"/contact-sales"),className:"font-bold underline",children:"contact sales"})," ","if you would be interested in upgrading to a paid version of Claude."]})};function u(){let e=(0,o.useCanUpgradeToPro)(),t=(0,o.useIsReadOnlyMode)();return e&&!t?(0,r.jsx)(s,{}):null}},11925:function(e,t,n){"use strict";n.d(t,{hH:function(){return D},wN:function(){return L},Qk:function(){return Z},pV:function(){return R},lE:function(){return z}});var r,a,o,i,s=n(27573),u=n(79755),l=n(11492),c=n(16096),d=n(59374),f=n(89937),h=n(28648),m=n(14983),p=n(35146),g=n(28505),v=n(43316),_=n(84983),b=n(2645),y=n(71875),w=n(54603),x=n(7653),C=n(80248),S=n(94354);class E{_set_raw_completion(e,t){0===this.start&&(this.start=Date.now()),this.text+=e,this.model_done=t,this.arrivals.push([(Date.now()-this.start)/1e3,this.text.length])}_get_smoothed_completion(){if(0===this.start)return"";let e=(Date.now()-this.start)/1e3,t=this.arrivals[this.arrivals.length-1][1]+(this.model_done?100:0),n=.9*e-.3,r=this.arrivals.filter(e=>e[0]<n).map(e=>e[1]),a=r[r.length-1],o=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.01;if(t===n)return t;let a=e(t),o=e(n);if(t>=n)throw Error("Lower x is greater than upper x");if(a>r)throw Error("Lower f is greater than zero");if(o<-r)throw Error("Upper f is less than zero");for(;a<-r;){let r=(t+n)/2,i=e(r);i<=0?(t=r,a=i):(n=r,o=i)}return t}(n=>{let r=(n-this.x)/(e-this.t),o=1/(e-this.t);return 2*this.gamma*o*(r-this.v)-1/(n-a)+1/(t-n)},a,t),i=(o-this.x)/(e-this.t);return this.v=this.alpha*this.v+(1-this.alpha)*i,this.x=Math.max(o,this.x),this.t=e,this.smoother_done=this.model_done&&this.x>=this.text.length,this.stats.push({t:e,x:o,v:i,min_chars:a,max_chars:t}),this.text.slice(0,this.x)}onMessage(e){this._set_raw_completion(e.completion,null!==e.stop)}async task(e,t){for(;!this.smoother_done&&!t.aborted;)e(this._get_smoothed_completion()),await new Promise(e=>setTimeout(e,10))}constructor(){this.alpha=.99,this.gamma=1e-5,this.v=100,this.x=0,this.t=0,this.arrivals=[[-9999,0]],this.start=0,this.text="",this.model_done=!1,this.smoother_done=!1,this.stats=[]}}var k=n(29351);async function T(e){let{frontendPrivateApiUrl:t,endpoint:n,orgUuid:r,conversationUuid:a,body:o,onCompletion:i,abortController:s,completion:u}=e,l=new E,c=l.task(i,s.signal),d=null,f="",m=JSON.stringify({...u,...o,text:void 0,rendering_mode:"raw",organization_uuid:void 0,conversation_uuid:void 0}),p=(0,k.L)(function(e,t,n,r){let a;if(void 0===n||void 0===r)throw Error("Missing org uuid or conversation uuid");switch(t){case 1:a="completion";break;case 2:a="retry_completion";break;default:throw Error("Invalid endpoint")}return"".concat(e,"/api/organizations/").concat(n,"/chat_conversations/").concat(r,"/").concat(a)}(t,n,r,a),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"text/event-stream"},body:m,openWhenHidden:!0,signal:s.signal,async onopen(e){var t;if(!e.ok||!(null===(t=e.headers.get("content-type"))||void 0===t?void 0:t.includes(k.a))){let t=await e.text(),n={};try{n=JSON.parse(t)}catch(e){}throw(0,h.fT)(e.status,n,"Failed to fetch",e.headers)}},onmessage(e){switch(e.event){case"ping":default:return;case"error":throw(0,h.fT)(0,JSON.parse(e.data),"Streaming error: 22");case"completion":{let t=JSON.parse(e.data);if(d=t,void 0===t.completion)throw Error("Unexpected message received when streaming: ".concat(e.data));f+=t.completion,l.onMessage(t)}}},onclose(){l.model_done=!0},onerror(e){throw e instanceof h.Hx&&529===e.statusCode||(0,v.Tb)(e),l.model_done=!0,l.smoother_done=!0,e}});return await Promise.all([p,c]),Object.assign({},d,{completion:f})}(r=o||(o={}))[r.APPEND_MESSAGE_WITH_COMPLETION=1]="APPEND_MESSAGE_WITH_COMPLETION",r[r.RETRY_MESSAGE_WITH_COMPLETION=2]="RETRY_MESSAGE_WITH_COMPLETION",(a=i||(i={})).Ping="ping",a.Completion="completion",a.Error="error";var O=n(50504),P=n(39206),j=n(27113),N=n(75763);let I=(0,x.createContext)([null,null]);function D(e){let{children:t}=e,n=(0,x.useState)({});return(0,s.jsx)(I.Provider,{value:n,children:t})}function R(e){let{onIncrementalCompletion:t,onStartAppend:n,onStreamCompleted:r}=(0,N.p)(),a=H({conversationUUID:e,endpoint:o.APPEND_MESSAGE_WITH_COMPLETION,onIncrementalCompletion:t,onStreamCompleted:r}),{runStream:i}=a,s=(0,x.useCallback)(async t=>{let{prompt:r,attachments:a,files:o,rethrowErrors:s=!1,modelOverride:u,parent_message_uuid:l}=t;await n(e,e=>{if(!e)throw Error("Conversation tree must be provided for tree append");let t=(0,O.HX)(e),n=[{uuid:O.wZ,text:r,created_at:new Date().toISOString(),sender:"human",attachments:a,files:o,index:t+1,parent_message_uuid:null!=l?l:O.QC},{uuid:O.FC,text:"",created_at:new Date().toISOString(),sender:"assistant",attachments:[],files:[],index:t+2,parent_message_uuid:O.wZ}];return(0,O.vv)(e,n)}),await i({prompt:r,attachments:a,files:o,rethrowErrors:s,modelOverride:u,parent_message_uuid:l})},[i,n,e]);return{...a,runStream:s}}function z(e){let{onIncrementalCompletion:t,onStreamCompleted:n,onStartAppend:r}=(0,N.p)(),a=H({conversationUUID:e,endpoint:o.RETRY_MESSAGE_WITH_COMPLETION,onIncrementalCompletion:t,onStreamCompleted:n}),{runStream:i}=a,s=(0,x.useCallback)(async t=>{await r(e,e=>{let n=[{uuid:O.FC,text:"",created_at:new Date().toISOString(),sender:"assistant",attachments:[],files:[],parent_message_uuid:t,selectedOption:0,index:(0,O.HX)(e)+1}];return(0,O.vv)(e,n)}),await i({prompt:"",attachments:[],files:[],parent_message_uuid:t})},[e,i,r]);return{...a,runStream:s}}let A="incomplete_stream",L=e=>{var t;let n=M(e),{layer:r}=(0,C.useLayer)("frontend"),a=null===(t=r.get("console_default_model_override",null))||void 0===t?void 0:t.model,{config:o}=(0,C.useConfig)("console_default_model"),i=o.get("model",null);return n||a||i||"claude-2.1"},M=e=>{let{data:t}=(0,S.Rq)(e||""),n=(0,w.useSearchParams)(),r=null==n?void 0:n.get("model");return(null==t?void 0:t.model)?null==t?void 0:t.model:r||void 0},Q={value:null},Z=()=>{let e=(0,_.useQueryClient)();return{failedStreamRetryData:(0,b.useQuery)([p.sf],()=>Q.value,{initialData:null}).data||null,setFailedStreamRetryData:(0,x.useCallback)(t=>{Q.value=t,e.invalidateQueries([p.sf])},[e])}};function H(e){var t;let{conversationUUID:n,endpoint:r,onIncrementalCompletion:a,onStreamCompleted:o}=e,{frontendPrivateApiUrl:i}=(0,l.useConfiguration)(),{activeOrganization:p}=(0,c.useCurrentAccount)(),_=null==p?void 0:p.uuid,{context:b,clearContext:C,setContext:E}=function(e){let[t,n]=(0,x.useContext)(I),[r,a]=(0,x.useState)(),o=(0,x.useCallback)(()=>{n?n(t=>{let n={...t};return delete n[e],n}):a(void 0)},[e,n]),i=(0,x.useCallback)(t=>{n?n(n=>({...n,[e]:t})):a(t)},[e,n]);return{context:t?t[e]:r,clearContext:o,setContext:i}}(n),k=(0,w.useSearchParams)(),O=null==k?void 0:k.get("t"),N=null!==(t=M(n))&&void 0!==t?t:"",D=null==k?void 0:k.get("max_tokens"),R=(0,j.n)(),{addError:z,clearToast:L}=(0,d.useToasts)(),Q=(0,x.useMemo)(g.H,[]),H=(0,S.$H)("push",Q),{setFailedStreamRetryData:U}=Z(),J=(0,x.useCallback)(async e=>{await (null==o?void 0:o(n,e)),C()},[o,n,C]),V="Network connection interrupted. Claude may still be responding, please wait for a bit to see the response.",F=(0,x.useCallback)((e,t)=>{if(e===A)return z(V);if(!(e instanceof h.Hx))return z("We couldn’t connect to Claude. Please check your network connection and try again.");if("rate_limit_error"===e.type){if(e.message.includes("{")&&_)try{let t=JSON.parse(e.message);R(t,_,n)}catch(e){}return z((0,s.jsxs)("p",{children:["You've reached the limit for Claude messages at this time. Please wait before trying again. ",(0,s.jsx)(u.Z,{})]}))}if("not_found_error"===e.type)return z((0,s.jsx)("p",{children:"Claude model version not found."}));if("overloaded_error"===e.type)return z((0,s.jsxs)("p",{children:["Due to unexpected capacity constraints, Claude is unable to respond to your message. Please try again soon.",(0,s.jsx)(u.Z,{})]}));if("invalid_request_error"===e.type&&413===e.statusCode){let e=z((0,s.jsxs)("p",{children:["Your message will exceed the"," ",(0,s.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:m.jC,children:"length limit"})," ","for this chat.",t>0?" Try attaching fewer or smaller files":" Try shortening your message"," ",(0,s.jsx)("a",{href:"#",className:"underline",onClick:t=>{t.preventDefault(),H(),L(e)},children:"or starting a new conversation."}),(0,s.jsx)(u.Z,{})]}));return}return"invalid_request_error"===e.type&&"read_only_mode"===e.extra.code?z((0,s.jsx)("p",{children:"Due to capacity constraints, chatting with Claude is currently not available. Please try again in a little while."})):z(e)},[z,_,R,n,H,L]),W=(0,f.K)(),Y=(0,x.useCallback)(async e=>{let{prompt:t,attachments:o,files:s,rethrowErrors:u=!1,modelOverride:l,parent_message_uuid:c}=e;if(b)return;if(!p)throw Error("Cannot stream without an organization");let d=new AbortController;E({controller:d}),U(null);let f={prompt:t,parent_message_uuid:c,timezone:y.ou.local().zoneName||void 0},h=(0,P.l)();h&&(f.custom_system_prompt=h),N&&"string"==typeof N&&(f.model=N),l&&(f.model=l),"string"==typeof O&&(f.temperature=parseInt(O)),D&&"string"==typeof D&&(f.max_tokens_to_sample=parseInt(D));let m="",g=null;try{g=await T({frontendPrivateApiUrl:i,endpoint:r,orgUuid:p.uuid,conversationUuid:n,body:{organization_uuid:p.uuid,conversation_uuid:n,text:t,attachments:o,files:s.map(e=>e.file_uuid)},onCompletion:e=>{a(n,e.substring(m.length)),m=e},abortController:d,completion:f})}catch(e){if(U({prompt:t,attachments:o,files:s}),F(e,o.length+s.length),u)throw e}finally{g&&!g.stop_reason&&(a(n,"\n\n```"+V+"```"),F(A,o.length+s.length),W.track("sse_interrupted"),(0,v.uT)("sse_interrupted"),await new Promise(e=>setTimeout(e,3e4))),await J(g)}return m},[i,b,p,E,N,O,a,n,r,F,J,D,U,W]),G=(0,x.useCallback)(()=>{b&&(b.controller.abort(),J(null))},[b,J]);return{runStream:Y,isStreaming:!!b,abortStream:G}}},39206:function(e,t,n){"use strict";n.d(t,{h:function(){return o},l:function(){return i}});var r=n(7653);let a="customSystemPrompt",o=()=>{let[e,t]=(0,r.useState)(()=>"undefined"==typeof localStorage?"":localStorage.getItem(a)||"");return(0,r.useEffect)(()=>{localStorage.setItem(a,e)},[e]),{customSystemPrompt:e,setCustomSystemPrompt:t}},i=()=>"undefined"==typeof localStorage?"":localStorage.getItem(a)},27113:function(e,t,n){"use strict";n.d(t,{I:function(){return l},n:function(){return u}});var r=n(83041),a=n(16096),o=n(35146),i=n(84983),s=n(7653);let u=()=>{let e=(0,i.useQueryClient)();return(0,s.useCallback)((t,n,r)=>{"within_limit"!==t.type&&t.perModelLimit&&(t.conversationUUID=r),e.setQueryData([o.aY],e=>e?{...e,messageLimits:{...e.messageLimits,[n]:t}}:e)},[e])},l=e=>{let{activeOrganization:t}=(0,a.useCurrentAccount)(),n=null==t?void 0:t.uuid,o=u(),i={type:"within_limit"};return(0,r.uC)(()=>"/api/organizations/".concat(n,"/reset_rate_limits"),"POST",{onSuccess:()=>{o(i,n,e||"")},meta:{noToast:!0}})}},75763:function(e,t,n){"use strict";n.d(t,{p:function(){return l}});var r=n(16096),a=n(35146),o=n(84983),i=n(7653),s=n(50504),u=n(27113);let l=()=>{let e=(0,o.useQueryClient)(),{activeOrganization:t}=(0,r.useCurrentAccount)(),n=null==t?void 0:t.uuid,l=(0,i.useRef)(),c=(0,u.n)(),d=(0,i.useCallback)(async(t,r)=>{let o=[a.I8,{orgUUID:n},{uuid:t}],i=e.getQueryData(o);if(!i)throw Error("Conversation tree must be provided for append");let s=r(i);l.current=s,await e.cancelQueries(o),e.setQueryData(o,l.current)},[e,n]),f=(0,i.useCallback)((t,r)=>{""!==r&&e.setQueryData([a.I8,{orgUUID:n},{uuid:t}],()=>{let e=l.current;if(!e)throw Error("Conversation tree must be provided for incremental completion");if(!e.current_leaf_message_uuid)throw Error("Couldn't figure out where to put completion");let t=e.messageByUuid.get(e.current_leaf_message_uuid);if(!t)throw Error("New assistant message not found");return t.text+=r,{...e,created_at:new Date().toISOString()}})},[e,n]);return{onStartAppend:d,onStreamCompleted:(0,i.useCallback)(async(t,r)=>{let o=[a.I8,{orgUUID:n},{uuid:t}];l.current=void 0,r?(e.setQueryData([a.tv,{orgUUID:n}],e=>{if(!e)return;let n=e.find(e=>e.uuid===t);return n?[{...n,updated_at:new Date().toISOString()},...e.filter(e=>e.uuid!==t)]:e}),await e.invalidateQueries(o)):e.invalidateQueries(o);let i=null==r?void 0:r.messageLimit;i&&n&&c(i,n,t)},[e,c,n]),onIncrementalCompletion:f,changeDisplayedConversationPath:(0,i.useCallback)((t,r,o,i)=>{e.setQueryData([a.I8,{orgUUID:n},{uuid:t}],e=>{if(!e)throw Error("Conversation tree must be provided for changeDisplayedConversationPath");let t=(0,s.mj)(e,r,o);return t.current_leaf_message_uuid&&i&&i(t.current_leaf_message_uuid),t})},[e,n])}}},39850:function(e,t,n){"use strict";n.r(t),n.d(t,{ConsentProvider:function(){return m},useConsent:function(){return p}});var r=n(27573),a=n(14983),o=n(27794),i=n.n(o),s=n(7653),u=n(43316),l=n(23532),c=n(91600),d=n(21728),f=n(83243);let h=(0,s.createContext)({showConsentBanner:!1,openConsentBanner:i(),preferences:f.iw,savePreferences:i()}),m=e=>{let{children:t,requiresExplicitConsent:n}=e,[o,i,m]=function(e,t){let n=(0,l.useCookies)(),[r,a]=(0,s.useState)(()=>!!n.get(e)),[o,i]=(0,s.useState)(()=>{try{let r=n.get(e);return r?JSON.parse(r):t}catch(n){return(0,u.Tb)(n,{extra:{message:"Malformed JSON cookie",cookieKey:e}}),t}});return[o,(0,s.useCallback)(t=>{n.set(e,JSON.stringify(t)),i(t),a(!0)},[n,e]),r]}(a.cn.CONSENT_PREFERENCES,n?f.iw:f.DF),[p,g]=(0,s.useState)(n&&!m),v=(0,s.useCallback)(e=>{i(e),(0,c.HF)(e),g(!1),d.u.updateCategories(e)},[i,g]);return(0,r.jsx)(h.Provider,{value:{showConsentBanner:p,openConsentBanner:()=>g(!0),preferences:o,savePreferences:v},children:t})};function p(){return(0,s.useContext)(h)}},59374:function(e,t,n){"use strict";n.r(t),n.d(t,{ErrorsProvider:function(){return i},useToasts:function(){return s}});var r=n(27573),a=n(7653);let o=(0,a.createContext)(void 0);function i(e){let{children:t}=e,n=(0,a.useRef)(1),[i,s]=(0,a.useState)([]),u=(0,a.useCallback)(e=>{let t=n.current++;return s(n=>[...n,{id:t,message:e instanceof Error?e.message:e,toastType:"error"}]),t},[]),l=(0,a.useCallback)(e=>{let t=n.current++;return s(n=>[...n,{id:t,message:e,toastType:"success"}]),t},[]),c=(0,a.useCallback)(e=>{s(t=>t.filter(t=>t.id!==e))},[]),d=(0,a.useMemo)(()=>({toasts:i,addError:u,addSuccess:l,clearToast:c}),[i,u,l,c]);return(0,r.jsx)(o.Provider,{value:d,children:t})}function s(){let e=(0,a.useContext)(o);if(!e)throw Error("Must be called within ErrorsProvider");return e}},91600:function(e,t,n){"use strict";n.d(t,{HF:function(){return o},bq:function(){return a}});var r=n(43316);let a=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];try{"function"==typeof window.gtag&&gtag(e,...n)}catch(e){(0,r.Tb)(e)}},o=e=>{a("consent","update",i(e))},i=e=>({ad_personalization:e.marketing?"granted":"denied",ad_user_data:e.marketing?"granted":"denied",ad_storage:e.marketing?"granted":"denied",analytics_storage:e.analytics?"granted":"denied",functionality_storage:"granted",personalization_storage:"granted",security_storage:"granted"})},92627:function(e,t,n){"use strict";n.d(t,{Rr:function(){return s}});var r=n(23203),a=n.n(r),o=n(7653);let i=(e,t)=>e===window.localStorage?"LSS-".concat(t):"SSS-".concat(t);function s(e,t){return function(e,t,n){let[r,s]=(0,o.useState)(()=>{if(null===e)return n;try{let r=e.getItem(i(e,t));return r?JSON.parse(r):n}catch(e){return console.log(e),n}}),u=(0,o.useRef)(a()(r=>{if(null!==e)try{if(JSON.stringify(r)===JSON.stringify(n)){e.removeItem(i(e,t));return}e.setItem(i(e,t),JSON.stringify(r))}catch(e){console.log(e)}},250)),l=(0,o.useCallback)(()=>{s(n),setTimeout(()=>{null!==e&&(u.current.cancel(),e.removeItem(i(e,t)))},0)},[s,n,e,t]);return(0,o.useEffect)(()=>{u.current(r)},[r]),[r,s,l]}(window.localStorage,e,t)}},96111:function(e,t,n){"use strict";var r=n(27573),a=n(2715),o=n(47828),i=n(44115),s=n(77997),u=n(7653);let l=(0,o.j)("inline-flex\n  items-center\n  justify-center\n  relative\n  shrink-0\n  ring-offset-2\n  ring-offset-bg-300\n  ring-accent-main-100\n  focus-visible:outline-none\n  focus-visible:ring-1\n  disabled:pointer-events-none\n  disabled:opacity-50\n  disabled:shadow-none\n  disabled:drop-shadow-none",{variants:{variant:{primary:"\n          bg-accent-main-100\n          bg-gradient-to-r\n          from-accent-main-100\n          via-accent-main-200/50\n          to-accent-main-200\n          bg-[length:200%_100%]\n          hover:bg-right\n          active:bg-accent-main-000\n          border-0.5\n          border-border-300\n          text-oncolor-100\n          font-medium\n          font-styrene\n          drop-shadow-sm\n          transition-all\n          shadow-[inset_0_0.5px_0px_rgba(255,255,0,0.15)]\n          [text-shadow:_0_1px_2px_rgb(0_0_0_/_10%)]\n          active:shadow-[inset_0_1px_6px_rgba(0,0,0,0.2)]\n          hover:from-accent-main-200\n          hover:to-accent-main-200",flat:"bg-accent-main-100\n          text-oncolor-100\n          font-medium\n          font-styrene\n          transition-colors\n          hover:bg-accent-main-200",secondary:"\n          bg-[radial-gradient(ellipse,_var(--tw-gradient-stops))]\n          from-bg-500/10\n          from-50%\n          to-bg-500/30\n          border-0.5\n          border-border-400\n          font-medium\n          font-styrene\n          text-text-100/90\n          transition-colors\n          active:bg-bg-500/50\n          hover:text-text-000\n          hover:bg-bg-500/60",outline:"border-1.5\n          font-medium\n          font-styrene\n          bg-transparent\n          text-text-200\n          transition-colors\n          hover:text-text-100\n          hover:bg-bg-400\n          hover:border-bg-400",ghost:"text-text-200\n          transition-all\n          font-styrene\n          active:bg-bg-400\n          hover:bg-bg-500/40\n          hover:text-text-100",underline:"opacity-80\n          transition-all\n          active:scale-[0.985]\n          hover:opacity-100\n          hover:underline\n          underline-offset-3",danger:"bg-danger-100\n          text-oncolor-100\n          font-medium\n          font-styrene\n          transition-colors\n          hover:bg-danger-200",unstyled:""},size:{default:"h-9 px-4 py-2 rounded-lg min-w-[5rem] active:scale-[0.985] whitespace-nowrap",sm:"h-8 rounded-md px-3 text-xs min-w-[4rem] active:scale-[0.985] whitespace-nowrap",lg:"h-11 rounded-[0.6rem] px-5 min-w-[6rem] active:scale-[0.985] whitespace-nowrap",icon:"h-9 w-9 rounded-md active:scale-95 shrink-0",icon_xs:"h-6 w-6 rounded-md active:scale-95",icon_sm:"h-8 w-8 rounded-md active:scale-95",icon_lg:"h-11 w-11 rounded-[0.6rem] active:scale-95",inline:"px-0.5 rounded-[0.25rem]",unset:""},option:{rounded:"!rounded-full",prepend:"",append:""},state:{active:""}},compoundVariants:[{size:"default",option:"prepend",class:"pl-2 pr-3 gap-1"},{size:"lg",option:"prepend",class:"pl-2.5 pr-3.5 gap-1"},{size:"sm",option:"prepend",class:" pl-2 pr-2.5 gap-1"},{size:"default",option:"append",class:"pl-3 pr-2 gap-1"},{size:"lg",option:"append",class:"pl-3.5 pr-2.5 gap-1"},{size:"sm",option:"append",class:"pl-2.5 pr-2 gap-1"},{variant:"ghost",state:"active",class:"!bg-bg-400"}],defaultVariants:{variant:"primary",size:"default"}}),c=(0,u.forwardRef)((e,t)=>{let{className:n,variant:o,size:u,option:c,loading:d,href:f,target:h,prepend:m,append:p,state:g,disabled:v,children:_,...b}=e;m&&(c="prepend"),p&&(c="append");let y=(0,i.Z)(l({variant:o,size:u,option:c,state:g,className:n}),d&&"text-transparent ![text-shadow:_none]"),w=(0,r.jsxs)(r.Fragment,{children:[d&&(0,r.jsx)("div",{className:(0,i.Z)("absolute inset-0 flex items-center justify-center",o&&"primary"!==o&&"flat"!==o&&"danger"!==o?"text-text-200":"text-oncolor-100"),children:(0,r.jsx)(a.Z,{size:"sm",inheritColor:!0})}),m,_,p]});return f?(0,r.jsx)(s.default,{href:f,target:h||"_self",className:y,"aria-label":b["aria-label"],children:w}):(0,r.jsx)("button",{className:y,ref:t,disabled:v||d,...b,children:w})});c.displayName="Button",t.Z=c},2715:function(e,t,n){"use strict";var r=n(27573),a=n(44115),o=n(7653);t.Z=(0,o.memo)(function(e){let{size:t="md",fullscreen:n=!1,inheritColor:o}=e;return(0,r.jsx)("div",{className:(0,a.Z)(n?"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2":"m-auto"),children:(0,r.jsx)("div",{className:(0,a.Z)("sm"===t&&"h-4 w-4 border-2","md"===t&&"h-20 w-20 border-8",o?"border-current":"border-border-200","text-secondary inline-block animate-spin rounded-full border-solid border-r-transparent align-[-0.125em] motion-reduce:animate-[spin_1.5s_linear_infinite]"),role:"status",children:(0,r.jsx)("span",{className:"sr-only",children:"Loading..."})})})})},84095:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var r=n(58936),a=n(27573),o=n(92472),i=n(85165),s=n(44115);function u(){let e=(0,r._)(["\n  px-2\n  py-1\n  text-xs\n  font-medium\n  font-sans\n  leading-tight\n  rounded-md\n  shadow-md\n  text-white\n  bg-black/80\n  backdrop-blur\n  break-words\n  z-50\n  max-w-[13rem]\n  [*:disabled_&]:hidden\n"]);return u=function(){return e},e}function l(e){let{children:t,tooltipContent:n,side:r="top",className:o,...u}=e;return(0,a.jsx)(i.zt,{delayDuration:0,children:(0,a.jsxs)(i.fC,{...u,children:[(0,a.jsx)(i.xz,{asChild:!0,children:t}),(0,a.jsx)(i.h_,{children:(0,a.jsx)(c,{className:(0,s.Z)(o,!n&&"hidden"),sideOffset:5,side:r,children:n})})]})})}let c=(0,o.Z)(i.VY)(u())},76987:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(27573);function a(e){let{size:t=16}=e;return(0,r.jsx)("svg",{width:t,height:t,viewBox:"0 0 28 28",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M20 4h-4.3l7.7 19.5h4.2L20 4ZM7.6 4 0 23.5h4.3L6 19.4h8l1.6 4h4.3L12.1 4H7.7Zm-.4 11.8 2.6-6.9 2.7 6.9H7.3Z"})})}},92472:function(e,t,n){"use strict";var r=n(44115),a=n(7653);function o(e){return function(t){for(var n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];let s=t.map(e=>e.replace(/\n/g,"").trim()),u=a.forwardRef((t,n)=>{let{className:i,...u}=t,l=o.map(e=>"function"==typeof e?e(t):e);return a.createElement(e,{...u,ref:n,className:(0,r.Z)(s,l,"string"==typeof i?i:"")})});return u.displayName="string"==typeof e?e:e.displayName,u}}function i(e){return o(e)}i.a=o("a"),i.aside=o("aside"),i.button=o("button"),i.main=o("main"),i.div=o("div"),i.form=o("form"),i.nav=o("nav"),i.fieldset=o("fieldset"),i.header=o("header"),i.h1=o("h1"),i.h2=o("h2"),i.h3=o("h3"),i.h4=o("h4"),i.h5=o("h5"),i.th=o("th"),i.td=o("td"),i.input=o("input"),i.label=o("label"),i.p=o("p"),i.section=o("section"),i.span=o("span"),i.li=o("li"),t.Z=i},23904:function(e,t,n){"use strict";n.r(t),n.d(t,{ThemeProvider:function(){return c},useTheme:function(){return p}});var r=n(27573),a=n(23532),o=n(92627),i=n(14983),s=n(7653);let u="(prefers-color-scheme: dark)",l=(0,s.createContext)(void 0);function c(e){let{initialTheme:t,children:n}=e,[i,c]=(0,s.useState)(t),h=(0,a.useCookies)(),[m,p]=(0,o.Rr)("userThemeMode","auto");(0,s.useEffect)(()=>d(i),[i]),(0,s.useEffect)(()=>f(m,h),[h,m]);let g=(0,s.useCallback)(()=>f(m,h),[h,m]);return(0,s.useEffect)(()=>{if("auto"!==m)return;let e=window.matchMedia(u);return e.addEventListener("change",g),()=>e.removeEventListener("change",g)},[m,g]),(0,r.jsx)(l.Provider,{value:{theme:i,mode:m,setMode:p,setTheme:c},children:n})}let d=e=>{"undefined"!=typeof document&&(document.documentElement.dataset.theme=e,h())},f=(e,t)=>{if("undefined"==typeof document)return;let n=m(e);t.set(i.cn.COLOR_MODE,n),document.documentElement.dataset.mode=n,h()},h=()=>{let[e,t,n]=getComputedStyle(document.documentElement).getPropertyValue("--bg-200").split(" "),r="hsl(".concat(e,",").concat(t,",").concat(n,")"),a=document.querySelector('meta[name="theme-color"]');a||((a=document.createElement("meta")).setAttribute("name","theme-color"),document.head.appendChild(a)),a.setAttribute("content",r)},m=e=>{var t;return"auto"!==e?e:(null===(t=window)||void 0===t?void 0:t.matchMedia(u).matches)?"dark":"light"},p=()=>{let e=(0,s.useContext)(l);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}},29351:function(e,t,n){"use strict";async function r(e,t){let n;let r=e.getReader();for(;!(n=await r.read()).done;)t(n.value)}function a(){return{data:"",event:"",id:"",retry:void 0}}n.d(t,{a:function(){return i},L:function(){return u}});var o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)0>t.indexOf(r[a])&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]]);return n};let i="text/event-stream",s="last-event-id";function u(e,t){var{signal:n,headers:u,onopen:c,onmessage:d,onclose:f,onerror:h,openWhenHidden:m,fetch:p}=t,g=o(t,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((t,o)=>{let v;let _=Object.assign({},u);function b(){v.abort(),document.hidden||E()}_.accept||(_.accept=i),"undefined"==typeof document||m||document.addEventListener("visibilitychange",b);let y=1e3,w=0;function x(){"undefined"==typeof document||m||document.removeEventListener("visibilitychange",b),clearTimeout(w),v.abort()}null==n||n.addEventListener("abort",()=>{x(),t()});let C=null!=p?p:fetch,S=null!=c?c:l;async function E(){var n,i;v=new AbortController;try{let n,o,u,l;let c=await C(e,Object.assign(Object.assign({},g),{headers:_,signal:v.signal}));await S(c),await r(c.body,(i=function(e,t,n){let r=a(),o=new TextDecoder;return function(i,s){if(0===i.length)null==e||e(r),r=a();else if(s>0){let e=o.decode(i.subarray(0,s)),a=s+(32===i[s+1]?2:1),u=o.decode(i.subarray(a));switch(e){case"data":r.data=r.data?r.data+"\n"+u:u;break;case"event":r.event=u;break;case"id":null==t||t(r.id=u);break;case"retry":let l=parseInt(u,10);isNaN(l)||null==n||n(r.retry=l)}}}}(d,e=>{e?_[s]=e:delete _[s]},e=>{y=e}),l=!1,function(e){void 0===n?(n=e,o=0,u=-1):n=function(e,t){let n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}(n,e);let t=n.length,r=0;for(;o<t;){l&&(10===n[o]&&(r=++o),l=!1);let e=-1;for(;o<t&&-1===e;++o)switch(n[o]){case 58:-1===u&&(u=o-r);break;case 13:l=!0;case 10:e=o}if(-1===e)break;i(n.subarray(r,e),u),r=o,u=-1}r===t?n=void 0:0!==r&&(n=n.subarray(r),o-=r)})),null==f||f(),x(),t()}catch(e){if(!v.signal.aborted)try{let t=null!==(n=null==h?void 0:h(e))&&void 0!==n?n:y;clearTimeout(w),w=setTimeout(E,t)}catch(e){x(),o(e)}}}E()})}function l(e){let t=e.headers.get("content-type");if(!(null==t?void 0:t.startsWith(i)))throw Error(`Expected content-type to be ${i}, Actual: ${t}`)}}},function(e){e.O(0,[248,2645,3040,7992,789,2171,6895,3688,4145,7486,8618,3674,1911,4592,1875,3211,4063,8494,4354,2673,7746,1293,1362,8114,1744],function(){return e(e.s=21403)}),_N_E=e.O()}]);